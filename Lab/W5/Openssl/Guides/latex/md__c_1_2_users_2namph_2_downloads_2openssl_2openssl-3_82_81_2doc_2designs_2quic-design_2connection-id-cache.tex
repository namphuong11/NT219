\chapter{QUIC Connection ID Cache}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache}{}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache}\index{QUIC Connection ID Cache@{QUIC Connection ID Cache}}
The connection ID cache is responsible for managing connection IDs, both local and remote.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md240}{}\doxysection{\texorpdfstring{Remote Connection IDs}{Remote Connection IDs}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md240}
For remote connection IDs, we need to be able to\+:


\begin{DoxyItemize}
\item add new IDs per connection;
\item pick a non-\/retired ID associated from those available for a connection and
\item select a connection ID by sequence number and retire that and all older IDs.
\end{DoxyItemize}

The cache will be implemented as a double ended queue as part of the QUIC\+\_\+\+CONNECTION object. The queue will be sorted by sequence number and must maintain a count of the number of connection IDs present. There is no requirement to maintain a global mapping since remote IDs are only used when sending packets, not receiving them.

In MVP, a many-\/to-\/1 matching of Connection IDs per Connection object is required. Refer third paragraph in \href{(https://datatracker.ietf.org/doc/html/rfc9000\#section-5.1)}{\texttt{ 5.\+1}}.

When picking a non-\/retired connection ID for MVP, the youngest available will be chosen.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md241}{}\doxysection{\texorpdfstring{Local Connection IDs}{Local Connection IDs}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md241}
For local connection IDs, we need to be able to\+:


\begin{DoxyItemize}
\item generate a new connection ID and associate it with a connection;
\item query if a connection ID is present;
\item for a server, map a connection ID to a QUIC\+\_\+\+CONNECTION;
\item drop all connection IDs associated with a QUIC\+\_\+\+CONNECTION;
\item select a connection ID by sequence number and retire that and all older IDs and
\item select a connection ID by sequence number and drop that and all older IDs.
\end{DoxyItemize}

All connection IDs issued by our stack must be the same length because short form packets include the connection ID but no length byte. Random connection IDs of this length will be allocated. Note that no additional information will be contained in the connection ID.

There will be one global set of local connection IDs, {\ttfamily QUIC\+\_\+\+ROUTE\+\_\+\+TABLE}, which is shared by all connections over all SSL\+\_\+\+CTX objects. This is used to dispatch incoming datagrams to their correct destination and will be implemented as a dictionary.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md242}{}\doxysubsection{\texorpdfstring{Notes}{Notes}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md242}

\begin{DoxyItemize}
\item For MVP, it would be sufficient to only use a zero length connection ID.
\item For MVP, a connection ID to QUIC\+\_\+\+CONNECTION mapping need not be implemented.
\item Post MVP, funnelling all received packets through a single socket is likely to be bottleneck. An alternative would be receiving from \texorpdfstring{$<$}{<}host address, source port\texorpdfstring{$>$}{>} pairs.
\item For MVP, the local connection ID cache need only have one element. I.\+e. there is no requirement to implement any form of lookup.
\end{DoxyItemize}\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md243}{}\doxysection{\texorpdfstring{Routes}{Routes}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md243}
A pair of connection IDs identify a route between the two ends of the communication. This contains the connection IDs of both ends of the connection and the common sequence number. We need to be able to\+:


\begin{DoxyItemize}
\item select a connection ID by sequence number and retire that and all older IDs and
\item select a connection ID by sequence number and drop that and all older IDs.
\end{DoxyItemize}

It is likely that operations on local and remote connection IDs can be subsumed by the route functionality.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md244}{}\doxysection{\texorpdfstring{ID Retirement}{ID Retirement}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md244}
Connection IDs are retired by either a \href{(https://datatracker.ietf.org/doc/html/rfc9000\#section-19.15)}{\texttt{ NEW\+\_\+\+CONNECTION\+\_\+\+ID}} or a \href{(https://datatracker.ietf.org/doc/html/rfc9000\#section-19.16)}{\texttt{ RETIRE\+\_\+\+CONNECTION\+\_\+\+ID}} frame and this is acknowledged by a RETIRE\+\_\+\+CONNECTION\+\_\+\+ID or a NEW\+\_\+\+CONNECTION\+\_\+\+ID frame respectively.

When a retirement frame is received, we can immediately {\itshape remove} the IDs covered from our cache and then send back an acknowledgement of the retirement.

If we want to retire a frame, we send a retirement frame and mark the IDs covered in our cache as {\itshape retired}. This means that we cannot send using any of these IDs but can still receive using them. Once our peer acknowledges the retirement, we can {\itshape remove} the IDs.

It is possible to receive out of order packets {\bfseries{after}} receiving a retirement notification. It\textquotesingle{}s unclear what to do with these, however dropping them seems reasonable. The alternative would be to maintain the route in a {\itshape deletable} state until all packets in flight at the time of retirement have been acked.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md245}{}\doxysection{\texorpdfstring{API}{API}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md245}
QUIC connection IDs are defined in \#18949 but some extra functions are available\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{/*\ QUIC\ connection\ ID\ representation.\ */}}
\DoxyCodeLine{\textcolor{preprocessor}{\#define\ QUIC\_MAX\_CONN\_ID\_LEN\ \ \ 20}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structquic__conn__id__st}{quic\_conn\_id\_st}}\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ id\_len;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ \textcolor{keywordtype}{id}[QUIC\_MAX\_CONN\_ID\_LEN];}
\DoxyCodeLine{\textcolor{preprocessor}{\#if\ 0}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ likely\ required\ later,\ although\ this\ might\ not\ be\ the\ ideal\ location\ */}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ reset\_token[16];\ \ \textcolor{comment}{/*\ stateless\ reset\ token\ is\ per\ conn\ ID\ */}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\}\ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{static}\ ossl\_unused\ ossl\_inline\ \textcolor{keywordtype}{int}\ ossl\_quic\_conn\_id\_eq(\textcolor{keyword}{const}\ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ *a,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ *\mbox{\hyperlink{structb}{b}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*\ New\ functions\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_conn\_id\_set(\mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ *cid,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\textcolor{keywordtype}{id},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ id\_len);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_conn\_id\_generate(\mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ *cid);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md246}{}\doxysubsection{\texorpdfstring{Remote Connection ID APIs}{Remote Connection ID APIs}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md246}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }quic\_remote\_conn\_id\_cache\_st\ QUIC\_REMOTE\_CONN\_ID\_CACHE;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Allocate\ and\ free\ a\ remote\ connection\ ID\ cache}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{QUIC\_REMOTE\_CONN\_ID\_CACHE\ *ossl\_quic\_remote\_conn\_id\_cache\_new(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ id\_limit\ \ \ \textcolor{comment}{/*\ [active\_connection\_id\_limit]\ */}}
\DoxyCodeLine{\ \ \ \ );}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ ossl\_quic\_remote\_conn\_id\_cache\_free(QUIC\_REMOTE\_CONN\_ID\_CACHE\ *cache);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Add\ a\ remote\ connection\ ID\ to\ the\ cache}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_remote\_conn\_id\_cache\_add(QUIC\_REMOTE\_CONN\_ID\_CACHE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *conn,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *conn\_id,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ conn\_id\_len,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ seq\_no);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Query\ a\ remote\ connection\ for\ a\ connection\ ID.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Each\ connection\ can\ have\ multiple\ connection\ IDs\ associated\ with\ different}}
\DoxyCodeLine{\textcolor{comment}{\ *\ routes.\ \ This\ function\ returns\ one\ of\ these\ in\ a\ non-\/specified\ manner.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_remote\_conn\_id\_cache\_get0\_conn\_id(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QUIC\_REMOTE\_CONN\_ID\_CACHE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *conn,\ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ **cid);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Retire\ remote\ connection\ IDs\ up\ to\ and\ including\ the\ one\ determined\ by\ the}}
\DoxyCodeLine{\textcolor{comment}{\ *\ sequence\ number.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_remote\_conn\_id\_cache\_retire(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ QUIC\_REMOTE\_CONN\_ID\_CACHE\ *cache,\ uint64\_t\ seq\_no);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Remove\ remote\ connection\ IDs\ up\ to\ and\ including\ the\ one\ determined\ by\ the}}
\DoxyCodeLine{\textcolor{comment}{\ *\ sequence\ number.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_remote\_conn\_id\_cache\_remove(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ QUIC\_REMOTE\_CONN\_ID\_CACHE\ *cache,\ uint64\_t\ seq\_no);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md247}{}\doxysubsection{\texorpdfstring{Local Connection ID APIs}{Local Connection ID APIs}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md247}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }quic\_local\_conn\_id\_cache\_st\ QUIC\_LOCAL\_CONN\_ID\_CACHE;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Allocate\ and\ free\ a\ local\ connection\ ID\ cache}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{QUIC\_LOCAL\_CONN\_ID\_CACHE\ *ossl\_quic\_local\_conn\_id\_cache\_new(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ ossl\_quic\_local\_conn\_id\_cache\_free(QUIC\_LOCAL\_CONN\_ID\_CACHE\ *cache);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Generate\ a\ new\ random\ local\ connection\ ID\ and\ associate\ it\ with\ a\ connection.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ For\ MVP\ this\ could\ just\ be\ a\ zero\ length\ ID.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_local\_conn\_id\_cache\_new\_conn\_id(QUIC\_LOCAL\_CONN\_ID\_CACHE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *conn,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ **cid);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Remove\ a\ local\ connection\ and\ all\ associated\ cached\ IDs}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_local\_conn\_id\_cache\_remove\_conn(QUIC\_LOCAL\_CONN\_ID\_CACHE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *conn);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Lookup\ a\ local\ connection\ by\ ID.}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Returns\ the\ connection\ or\ NULL\ if\ absent.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *ossl\_quic\_local\_conn\_id\_cache\_get0\_conn(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QUIC\_LOCAL\_CONN\_ID\_CACHE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *conn\_id,\ \textcolor{keywordtype}{size\_t}\ conn\_id\_len);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Retire\ local\ connection\ IDs\ up\ to\ and\ including\ the\ one\ specified\ by\ the}}
\DoxyCodeLine{\textcolor{comment}{\ *\ sequence\ number.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_local\_conn\_id\_cache\_retire(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ QUIC\_LOCAL\_CONN\_ID\_CACHE\ *cache,\ uint64\_t\ from\_seq\_no);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Remove\ local\ connection\ IDs\ up\ to\ and\ including\ the\ one\ specified\ by\ the}}
\DoxyCodeLine{\textcolor{comment}{\ *\ sequence\ number.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_local\_conn\_id\_cache\_remove(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ QUIC\_LOCAL\_CONN\_ID\_CACHE\ *cache,\ uint64\_t\ from\_seq\_no);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md248}{}\doxysubsection{\texorpdfstring{Routes}{Routes}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md248}
Additional status and source information is also included.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }quic\_route\_st\ QUIC\_ROUTE;}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }quic\_route\_table\ QUIC\_ROUTE\_TABLE;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{struct\ }quic\_route\_st\ \{}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *conn;}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ \ \ \ \ local;}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ \ \ \ \ remote;}
\DoxyCodeLine{\ \ \ \ uint64\_t\ \ \ \ \ \ \ \ \ seq\_no;\ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Sequence\ number\ for\ both\ ends\ */}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \ \ \ \ retired\ :\ 1;\ \ \ \textcolor{comment}{/*\ Connection\ ID\ has\ been\ retired\ */}}
\DoxyCodeLine{\textcolor{preprocessor}{\#if\ 0}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{/*\ Later\ will\ require\ */}}
\DoxyCodeLine{\ \ \ \ BIO\_ADDR\ \ \ \ \ \ \ \ \ remote\_address;\textcolor{comment}{/*\ remote\ source\ address\ */}}
\DoxyCodeLine{\textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{QUIC\_ROUTE\_TABLE\ *ossl\_quic\_route\_table\_new(\textcolor{keywordtype}{void});}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ ossl\_quic\_route\_table\_free(QUIC\_ROUTE\_TABLE\ *routes);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md249}{}\doxysubsection{\texorpdfstring{Add route to route table}{Add route to route table}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md249}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_route\_table\_add\_route(QUIC\_ROUTE\_TABLE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ QUIC\_ROUTE\_TABLE\ *route);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md250}{}\doxysubsection{\texorpdfstring{Route query}{Route query}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md250}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Query\ a\ route\ table\ entry\ by\ either\ local\ or\ remote\ ID}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{QUIC\_ROUTE\ *ossl\_route\_table\_get0\_route\_from\_local(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QUIC\_ROUTE\_TABLE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *conn\_id,\ \textcolor{keywordtype}{size\_t}\ conn\_id\_len);}
\DoxyCodeLine{QUIC\_ROUTE\ *ossl\_route\_table\_get0\_route\_from\_remote(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ QUIC\_ROUTE\_TABLE\ *cache,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *conn\_id,\ \textcolor{keywordtype}{size\_t}\ conn\_id\_len);}

\end{DoxyCode}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md251}{}\doxysubsection{\texorpdfstring{Route retirement}{Route retirement}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2connection-id-cache_autotoc_md251}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Retire\ by\ sequence\ number\ up\ to\ and\ including\ the\ one\ specified.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_route\_table\_retire(QUIC\_ROUTE\_TABLE\ *routes,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *conn,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ seq\_no);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{\ *\ Delete\ by\ sequence\ number\ up\ to\ and\ including\ the\ one\ specified.}}
\DoxyCodeLine{\textcolor{comment}{\ */}}
\DoxyCodeLine{\textcolor{keywordtype}{int}\ ossl\_quic\_route\_table\_remove(QUIC\_ROUTE\_TABLE\ *routes,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structquic__conn__st}{QUIC\_CONNECTION}}\ *conn,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ seq\_no);}

\end{DoxyCode}
 