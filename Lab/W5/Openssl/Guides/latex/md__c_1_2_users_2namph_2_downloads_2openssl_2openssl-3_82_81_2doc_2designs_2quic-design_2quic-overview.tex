\chapter{QUIC Design Overview}
\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview}{}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview}\index{QUIC Design Overview@{QUIC Design Overview}}
The QUIC implementation in Open\+SSL is roughly described by the following picture.

\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md420}{}\doxysection{\texorpdfstring{SSL API}{SSL API}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md420}
The application facing public API of the Open\+SSL library.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md421}{}\doxysection{\texorpdfstring{Stream Send and Read Buffers}{Stream Send and Read Buffers}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md421}
Buffers for stream data to be sent or received from the peer over the QUIC protocol. These are necessary to support existing semantics of the SSL\+\_\+read and SSL\+\_\+write functions.

They will be bypassed with a single-\/copy API for read and write ({\itshape not for MVP}).\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md422}{}\doxysection{\texorpdfstring{Frame in Flight Manager}{Frame in Flight Manager}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md422}
The frame in flight manager manages the queueing of frames which may need to be retransmitted if the packets in which they were transmitted were lost. It is \doxysectlink{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-fifm}{discussed in more detail here.}{0}\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md423}{}\doxysection{\texorpdfstring{Connection State Machine}{Connection State Machine}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md423}
A state machine handling the state for a QUIC connection.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md424}{}\doxysection{\texorpdfstring{Connection ID Cache}{Connection ID Cache}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md424}
A table matching Connection IDs with Connection objects represented via SSL objects.

{\itshape In MVP there is a many-\/to-\/1 matching of Connection IDs to Connection objects. Refer third paragraph in \mbox{[}5.\+1\mbox{]}}\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md425}{}\doxysection{\texorpdfstring{Timer And Event Queue}{Timer And Event Queue}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md425}
Queue of events that need to be handled asynchronously or at a later time.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md426}{}\doxysection{\texorpdfstring{TLS Handshake Record Layer}{TLS Handshake Record Layer}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md426}
A module that uses the Record Layer API to implement the inner TLS-\/1.\+3 protocol handshake. It produces and parses the QUIC CRYPTO frames.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md427}{}\doxysection{\texorpdfstring{TX Packetizer}{TX Packetizer}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md427}
This module creates frames from the application data obtained from the application. It also receives CRYPTO frames from the TLS Handshake Record Layer and ACK frames from the ACK Handling And Loss Detector subsystem.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md428}{}\doxysection{\texorpdfstring{RX Frame Handler}{RX Frame Handler}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md428}
Decrypted packets are split into frames here and the frames are forwarded either as data or as events to the subsequent modules based on the frame type. Flow Controller And Statistics Collector is consulted for decisions and to record the statistics of the received stream data.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md429}{}\doxysection{\texorpdfstring{Flow Controller}{Flow Controller}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md429}
This module is consulted by the TX Packetizer and RX Frame Handler for flow control decisions at both the stream and connection levels.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md430}{}\doxysection{\texorpdfstring{Statistics Collector}{Statistics Collector}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md430}
This module maintains statistics about a connection, most notably the estimated round trip time to the remote peer.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md431}{}\doxysection{\texorpdfstring{QUIC Write Record Layer}{QUIC Write Record Layer}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md431}
Encryption of packets according to the given encryption level and with the appropriate negotiated algorithm happens here.

Resulting packets are sent through the Datagram BIO interface to the network.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md432}{}\doxysection{\texorpdfstring{QUIC Read Record Layer}{QUIC Read Record Layer}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md432}
Decryption of packets according to the given encryption level and with the appropriate negotiated algorithm happens here.

Packets are received from the network through the Datagram BIO interface.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md433}{}\doxysection{\texorpdfstring{Congestion Controller}{Congestion Controller}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md433}
This is a pluggable API that provides calls to record data relevant for congestion control decisions and to query for decision on whether more data is allowed to be sent or not.

The module is called by the TX Packetizer and the ACK Handling And Loss Detector modules.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md434}{}\doxysection{\texorpdfstring{ACK Handling And Loss Detector}{ACK Handling And Loss Detector}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md434}
A module that tracks packets sent to the peer and received ACK frames. It detects lost packets (after an ACK is not received in time). It informs TX packetizer that it can drop frames waiting to be ACKed when ACK is received. It also schedules retransmits of frames from packets that are considered to be lost.

The module also handles the receiving side -\/ it schedules when ACK frames should be sent for the received packets.\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md435}{}\doxysection{\texorpdfstring{Path And Conn Demultiplexer}{Path And Conn Demultiplexer}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md435}
On server side this module is shared between multiple SSL connection objects which makes it a special kind of module. It dispatches the received packets to the appropriate SSL Connection by consulting the Connection ID Cache.

{\itshape For client side and MVP this module just checks that the received packet has the appropriate Connection ID and optionally schedules sending stateless reset for packets with other Connection IDs.}\hypertarget{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md436}{}\doxysection{\texorpdfstring{Datagram BIO}{Datagram BIO}}\label{md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2doc_2designs_2quic-design_2quic-overview_autotoc_md436}
Implementation of BIO layer that supports {\ttfamily BIO\+\_\+sendmmsg} and {\ttfamily BIO\+\_\+recvmmsg} calls. 