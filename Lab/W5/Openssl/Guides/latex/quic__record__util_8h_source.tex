\doxysection{quic\+\_\+record\+\_\+util.\+h}
\hypertarget{quic__record__util_8h_source}{}\label{quic__record__util_8h_source}\index{C:/Users/namph/Downloads/openssl/openssl-\/3.2.1/include/internal/quic\_record\_util.h@{C:/Users/namph/Downloads/openssl/openssl-\/3.2.1/include/internal/quic\_record\_util.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Copyright\ 2022-\/2023\ The\ OpenSSL\ Project\ Authors.\ All\ Rights\ Reserved.}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *\ Licensed\ under\ the\ Apache\ License\ 2.0\ (the\ "{}License"{}).\ \ You\ may\ not\ use}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ this\ file\ except\ in\ compliance\ with\ the\ License.\ \ You\ can\ obtain\ a\ copy}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *\ in\ the\ file\ LICENSE\ in\ the\ source\ distribution\ or\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ https://www.openssl.org/source/license.html}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#ifndef\ OSSL\_QUIC\_RECORD\_UTIL\_H}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#\ define\ OSSL\_QUIC\_RECORD\_UTIL\_H}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#\ include\ <openssl/ssl.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#\ include\ "{}internal/quic\_types.h"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#\ ifndef\ OPENSSL\_NO\_QUIC}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structossl__qrx__st}{ossl\_qrx\_st}};}
\DoxyCodeLine{00019\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structossl__qtx__st}{ossl\_qtx\_st}};}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{/*}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ QUIC\ Key\ Derivation\ Utilities}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *\ =============================}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{comment}{/*\ HKDF-\/Extract(salt,\ IKM)\ (RFC\ 5869)\ */}}
\DoxyCodeLine{00027\ \textcolor{keywordtype}{int}\ ossl\_quic\_hkdf\_extract(OSSL\_LIB\_CTX\ *libctx,}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *propq,}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ EVP\_MD\ *md,}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *salt,\ \textcolor{keywordtype}{size\_t}\ salt\_len,}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *ikm,\ \textcolor{keywordtype}{size\_t}\ ikm\_len,}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *out,\ \textcolor{keywordtype}{size\_t}\ out\_len);}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{comment}{/*}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ *\ A\ QUIC\ client\ sends\ its\ first\ INITIAL\ packet\ with\ a\ random\ DCID,\ which}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ *\ is\ used\ to\ compute\ the\ secrets\ used\ for\ INITIAL\ packet\ encryption\ in\ both}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ *\ directions\ (both\ client-\/to-\/server\ and\ server-\/to-\/client).}}
\DoxyCodeLine{00038\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ *\ This\ function\ performs\ the\ necessary\ DCID-\/based\ key\ derivation,\ and\ then}}
\DoxyCodeLine{00040\ \textcolor{comment}{\ *\ provides\ the\ derived\ key\ material\ for\ the\ INITIAL\ encryption\ level\ to\ a\ QRX}}
\DoxyCodeLine{00041\ \textcolor{comment}{\ *\ instance,\ a\ QTX\ instance,\ or\ both.}}
\DoxyCodeLine{00042\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00043\ \textcolor{comment}{\ *\ This\ function\ derives\ the\ necessary\ key\ material\ and\ then:}}
\DoxyCodeLine{00044\ \textcolor{comment}{\ *\ \ \ -\/\ if\ qrx\ is\ non-\/NULL,\ provides\ the\ appropriate\ secret\ to\ it;}}
\DoxyCodeLine{00045\ \textcolor{comment}{\ *\ \ \ -\/\ if\ qtx\ is\ non-\/NULL,\ provides\ the\ appropriate\ secret\ to\ it.}}
\DoxyCodeLine{00046\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00047\ \textcolor{comment}{\ *\ If\ both\ qrx\ and\ qtx\ are\ NULL,\ this\ is\ a\ no-\/op.\ This\ function\ is\ equivalent\ to}}
\DoxyCodeLine{00048\ \textcolor{comment}{\ *\ making\ the\ appropriate\ calls\ to\ ossl\_qrx\_provide\_secret()\ and}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ *\ ossl\_qtx\_provide\_secret().}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00051\ \textcolor{comment}{\ *\ It\ is\ possible\ to\ use\ a\ QRX\ or\ QTX\ without\ ever\ calling\ this,\ for\ example\ if}}
\DoxyCodeLine{00052\ \textcolor{comment}{\ *\ there\ is\ no\ desire\ to\ handle\ INITIAL\ packets\ (e.g.\ if\ a\ QRX/QTX\ is}}
\DoxyCodeLine{00053\ \textcolor{comment}{\ *\ instantiated\ to\ succeed\ a\ previous\ QRX/QTX\ and\ handle\ a\ connection\ which\ is}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ *\ already\ established).\ However\ in\ this\ case\ you\ should\ make\ sure\ you\ call}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ *\ ossl\_qrx\_discard\_enc\_level();\ see\ the\ header\ for\ that\ function\ for\ more}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ *\ details.\ Calling\ ossl\_qtx\_discard\_enc\_level()\ is\ not\ essential\ but\ could}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ *\ protect\ against\ programming\ errors.}}
\DoxyCodeLine{00058\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00059\ \textcolor{comment}{\ *\ Returns\ 1\ on\ success\ or\ 0\ on\ error.}}
\DoxyCodeLine{00060\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00061\ \textcolor{keywordtype}{int}\ ossl\_quic\_provide\_initial\_secret(OSSL\_LIB\_CTX\ *libctx,}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *propq,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structquic__conn__id__st}{QUIC\_CONN\_ID}}\ *dst\_conn\_id,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ is\_server,}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct}\ \mbox{\hyperlink{structossl__qrx__st}{ossl\_qrx\_st}}\ *qrx,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct}\ \mbox{\hyperlink{structossl__qtx__st}{ossl\_qtx\_st}}\ *qtx);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{comment}{/*}}
\DoxyCodeLine{00069\ \textcolor{comment}{\ *\ QUIC\ Record\ Layer\ Ciphersuite\ Info}}
\DoxyCodeLine{00070\ \textcolor{comment}{\ *\ ==================================}}
\DoxyCodeLine{00071\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{comment}{/*\ Available\ QUIC\ Record\ Layer\ (QRL)\ ciphersuites.\ */}}
\DoxyCodeLine{00074\ \textcolor{preprocessor}{\#\ define\ QRL\_SUITE\_AES128GCM\ \ \ \ \ \ \ \ \ \ \ \ 1\ }\textcolor{comment}{/*\ SHA256\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#\ define\ QRL\_SUITE\_AES256GCM\ \ \ \ \ \ \ \ \ \ \ \ 2\ }\textcolor{comment}{/*\ SHA384\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00076\ \textcolor{preprocessor}{\#\ define\ QRL\_SUITE\_CHACHA20POLY1305\ \ \ \ \ 3\ }\textcolor{comment}{/*\ SHA256\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{comment}{/*\ Returns\ cipher\ name\ in\ bytes\ or\ NULL\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00079\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *ossl\_qrl\_get\_suite\_cipher\_name(uint32\_t\ suite\_id);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \textcolor{comment}{/*\ Returns\ hash\ function\ name\ in\ bytes\ or\ NULL\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00082\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *ossl\_qrl\_get\_suite\_md\_name(uint32\_t\ suite\_id);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \textcolor{comment}{/*\ Returns\ secret\ length\ in\ bytes\ or\ 0\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00085\ uint32\_t\ ossl\_qrl\_get\_suite\_secret\_len(uint32\_t\ suite\_id);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \textcolor{comment}{/*\ Returns\ key\ length\ in\ bytes\ or\ 0\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00088\ uint32\_t\ ossl\_qrl\_get\_suite\_cipher\_key\_len(uint32\_t\ suite\_id);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{comment}{/*\ Returns\ IV\ length\ in\ bytes\ or\ 0\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00091\ uint32\_t\ ossl\_qrl\_get\_suite\_cipher\_iv\_len(uint32\_t\ suite\_id);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{comment}{/*\ Returns\ AEAD\ auth\ tag\ length\ in\ bytes\ or\ 0\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00094\ uint32\_t\ ossl\_qrl\_get\_suite\_cipher\_tag\_len(uint32\_t\ suite\_id);}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{comment}{/*\ Returns\ a\ QUIC\_HDR\_PROT\_CIPHER\_*\ value\ or\ 0\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00097\ uint32\_t\ ossl\_qrl\_get\_suite\_hdr\_prot\_cipher\_id(uint32\_t\ suite\_id);}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \textcolor{comment}{/*\ Returns\ header\ protection\ key\ length\ in\ bytes\ or\ 0\ if\ suite\ ID\ is\ invalid.\ */}}
\DoxyCodeLine{00100\ uint32\_t\ ossl\_qrl\_get\_suite\_hdr\_prot\_key\_len(uint32\_t\ suite\_id);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \textcolor{comment}{/*}}
\DoxyCodeLine{00103\ \textcolor{comment}{\ *\ Returns\ maximum\ number\ of\ packets\ which\ may\ be\ safely\ encrypted\ with\ a\ suite}}
\DoxyCodeLine{00104\ \textcolor{comment}{\ *\ or\ 0\ if\ suite\ ID\ is\ invalid.}}
\DoxyCodeLine{00105\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00106\ uint64\_t\ ossl\_qrl\_get\_suite\_max\_pkt(uint32\_t\ suite\_id);}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{comment}{/*}}
\DoxyCodeLine{00109\ \textcolor{comment}{\ *\ Returns\ maximum\ number\ of\ RX'd\ packets\ which\ may\ safely\ fail\ AEAD\ decryption}}
\DoxyCodeLine{00110\ \textcolor{comment}{\ *\ for\ a\ given\ suite\ or\ 0\ if\ suite\ ID\ is\ invalid.}}
\DoxyCodeLine{00111\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00112\ uint64\_t\ ossl\_qrl\_get\_suite\_max\_forged\_pkt(uint32\_t\ suite\_id);}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \textcolor{preprocessor}{\#\ endif}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
