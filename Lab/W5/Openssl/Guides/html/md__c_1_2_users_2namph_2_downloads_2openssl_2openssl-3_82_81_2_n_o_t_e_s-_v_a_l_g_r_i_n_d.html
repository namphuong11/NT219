<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: Notes on Valgrind</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Notes on Valgrind</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Valgrind is a test harness that includes many tools such as memcheck, which is commonly used to check for memory leaks, etc. The default tool run by Valgrind is memcheck. There are other tools available, but this will focus on memcheck.</p>
<p>Valgrind runs programs in a virtual machine, this means OpenSSL unit tests run under Valgrind will take longer than normal.</p>
<h1><a class="anchor" id="autotoc_md896"></a>
Requirements</h1>
<ol type="1">
<li>Platform supported by Valgrind See <a href="http://valgrind.org/info/platforms.html">http://valgrind.org/info/platforms.html</a></li>
<li>Valgrind installed on the platform See <a href="http://valgrind.org/downloads/current.html">http://valgrind.org/downloads/current.html</a></li>
<li>OpenSSL compiled See <a class="el" href="md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2_i_n_s_t_a_l_l.html">INSTALL.md</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md897"></a>
Running Tests</h1>
<p>Test behavior can be modified by adjusting environment variables.</p>
<p><code>EXE_SHELL</code></p>
<p>This variable is used to specify the shell used to execute OpenSSL test programs. The default wrapper (<code>util/wrap.pl</code>) initializes the environment to allow programs to find shared libraries. The variable can be modified to specify a different executable environment. </p><pre class="fragment">EXE_SHELL=\
"`/bin/pwd`/util/wrap.pl valgrind --error-exitcode=1 --leak-check=full -q"
</pre><p> This will start up Valgrind with the default checker (<code>memcheck</code>). The <code>--error-exitcode=1</code> option specifies that Valgrind should exit with an error code of 1 when memory leaks occur. The <code>--leak-check=full</code> option specifies extensive memory checking. The <code>-q</code> option prints only error messages. Additional Valgrind options may be added to the <code>EXE_SHELL</code> variable.</p>
<p><code>OPENSSL_ia32cap</code></p>
<p>This variable controls the processor-specific code on Intel processors. By default, OpenSSL will attempt to figure out the capabilities of a processor, and use it to its fullest capability. This variable can be used to control what capabilities OpenSSL uses.</p>
<p>As of valgrind-3.15.0 on Linux/x86_64, instructions up to AVX2 are supported. Setting the following disables instructions beyond AVX2:</p>
<p><code>OPENSSL_ia32cap=":0"</code></p>
<p>This variable may need to be set to something different based on the processor and Valgrind version you are running tests on. More information may be found in <a href="doc/man3/OPENSSL_ia32cap.pod">doc/man3/OPENSSL_ia32cap.pod</a>.</p>
<p>Additional variables (such as <code>VERBOSE</code> and <code>TESTS</code>) are described in the file <a class="el" href="md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2test_2_r_e_a_d_m_e.html">test/README.md</a>.</p>
<p>Example command line: </p><pre class="fragment">$ make test EXE_SHELL="`/bin/pwd`/util/wrap.pl valgrind --error-exitcode=1 \
    --leak-check=full -q" OPENSSL_ia32cap=":0"
</pre><p> If an error occurs, you can then run the specific test via the <code>TESTS</code> variable with the <code>VERBOSE</code> or <code>VF</code> or <code>VFP</code> options to gather additional information. </p><pre class="fragment">$ make test VERBOSE=1 TESTS=test_test EXE_SHELL="`/bin/pwd`/util/wrap.pl \
   valgrind --error-exitcode=1 --leak-check=full -q" OPENSSL_ia32cap=":0"
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
