<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: Notes for Android platforms</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Notes for Android platforms</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md866"></a>
Requirement details</h1>
<p>Beside basic tools like perl and make, you'll need to download the Android NDK. It's available for Linux, macOS and Windows, but only Linux version was actually tested. There is no reason to believe that macOS wouldn't work. And as for Windows, it's unclear which "shell" would be suitable, MSYS2 might have best chances. NDK version should play lesser role, the goal is to support a range of most recent versions.</p>
<h1><a class="anchor" id="autotoc_md867"></a>
Configuration</h1>
<p>Android is a cross-compiled target and you can't rely on <code>./Configure</code> to find out the configuration target for you. You have to name your target explicitly; there are <code>android-arm</code>, <code>android-arm64</code>, <code>android-mips</code>, <code>android-mip64</code>, <code>android-x86</code> and <code>android-x86_64</code> (<code>*MIPS</code> targets are no longer supported with NDK R20+).</p>
<p>Do not pass &ndash;cross-compile-prefix (as you might be tempted), as it will be "calculated" automatically based on chosen platform. However, you still need to know the prefix to extend your PATH, in order to invoke <code>$(CROSS_COMPILE)clang</code> [<code>*gcc</code> on NDK 19 and lower] and company. (<code>./Configure</code> will fail and give you a hint if you get it wrong.)</p>
<p>Apart from <code>PATH</code> adjustment, you need to set <code>ANDROID_NDK_ROOT</code> environment to point at the <code>NDK</code> directory. If you're using a side-by-side NDK the path will look something like <code>/some/where/android-sdk/ndk/&lt;ver&gt;</code>, and for a standalone NDK the path will be something like <code>/some/where/android-ndk-&lt;ver&gt;</code>. Both variables are significant at both configuration and compilation times. The NDK customarily supports multiple Android API levels, e.g. <code>android-14</code>, <code>android-21</code>, etc. By default, latest API level is chosen. If you need to target an older platform pass the argument <code>-D__ANDROID_API__=N</code> to <code>Configure</code>, with <code>N</code> being the numerical value of the target platform version. For example, to compile for Android 10 arm64 with a side-by-side NDK r20.0.5594570</p>
<p>export ANDROID_NDK_ROOT=/home/whoever/Android/android-sdk/ndk/20.0.5594570 PATH=$ANDROID_NDK_ROOT/toolchains/llvm/prebuilt/linux-x86_64/bin:$ANDROID_NDK_ROOT/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin:$PATH ./Configure android-arm64 -D__ANDROID_API__=29 make</p>
<p>Older versions of the NDK have GCC under their common prebuilt tools directory, so the bin path will be slightly different. EG: to compile for ICS on ARM with NDK 10d:</p>
<p>export ANDROID_NDK_ROOT=/some/where/android-ndk-10d PATH=$ANDROID_NDK_ROOT/toolchains/arm-linux-androideabi-4.8/prebuilt/linux-x86_64/bin:$PATH ./Configure android-arm -D__ANDROID_API__=14 make</p>
<p>Caveat lector! Earlier OpenSSL versions relied on additional <code>CROSS_SYSROOT</code> variable set to <code>$ANDROID_NDK_ROOT/platforms/android-&lt;api&gt;/arch-&lt;arch&gt;</code> to appoint headers-n-libraries' location. It's still recognized in order to facilitate migration from older projects. However, since API level appears in <code>CROSS_SYSROOT</code> value, passing <code>-D__ANDROID_API__=N</code> can be in conflict, and mixing the two is therefore not supported. Migration to <code>CROSS_SYSROOT</code>-less setup is recommended.</p>
<p>One can engage clang by adjusting PATH to cover the same NDK's clang. Just keep in mind that if you miss it, Configure will try to use gcc... Also, PATH would need even further adjustment to cover unprefixed, yet target-specific, ar and ranlib. It's possible that you don't need to bother, if binutils-multiarch is installed on your Linux system.</p>
<p>Another option is to create so called "standalone toolchain" tailored for single specific platform including Android API level, and assign its location to <code>ANDROID_NDK_ROOT</code>. In such case, you have to pass matching target name to Configure and shouldn't use <code>-D__ANDROID_API__=N</code>. <code>PATH</code> adjustment becomes simpler, <code>$ANDROID_NDK_ROOT/bin:$PATH</code> suffices.</p>
<h1><a class="anchor" id="autotoc_md868"></a>
Running tests (on Linux)</h1>
<p>This is not actually supported. Notes are meant rather as inspiration.</p>
<p>Even though build output targets alien system, it's possible to execute test suite on Linux system by employing qemu-user. The trick is static linking. Pass -static to Configure, then edit generated Makefile and remove occurrences of -ldl and -pie flags. You would also need to pick API version that comes with usable static libraries, 42/2=21 used to work. Once built, you should be able to</p>
<p>env EXE_SHELL=qemu-&lt;arch&gt; make test</p>
<p>If you need to pass additional flag to qemu, quotes are your friend, e.g.</p>
<p>env EXE_SHELL="qemu-mips64el -cpu MIPS64R6-generic" make test </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
