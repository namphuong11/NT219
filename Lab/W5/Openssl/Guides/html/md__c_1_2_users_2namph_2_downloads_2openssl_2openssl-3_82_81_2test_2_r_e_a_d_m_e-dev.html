<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: Guidelines for test developers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Guidelines for test developers</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md973"></a>
How to add recipes</h1>
<p>For any test that you want to perform, you write a script located in <code>test/recipes/</code>, named <code>{nn}-test_{name}.t</code>, where <code>{nn}</code> is a two digit number and <code>{name}</code> is a unique name of your choice.</p>
<p>Please note that if a test involves a new testing executable, you will need to do some additions in test/build.info. Please refer to the section <a href="README.md#changes-to-testbuildinfo">"Changes to test/build.info"</a> below.</p>
<h1><a class="anchor" id="autotoc_md974"></a>
Naming conventions</h1>
<p>A test executable is named <code>test/{name}test.c</code></p>
<p>A test recipe is named <code>test/recipes/{nn}-test_{name}.t</code>, where <code>{nn}</code> is a two digit number and <code>{name}</code> is a unique name of your choice.</p>
<p>The number <code>{nn}</code> is (somewhat loosely) grouped as follows: </p><pre class="fragment">00-04  sanity, internal and essential API tests
05-09  individual symmetric cipher algorithms
10-14  math (bignum)
15-19  individual asymmetric cipher algorithms
20-24  openssl commands (some otherwise not tested)
25-29  certificate forms, generation and verification
30-35  engine and evp
60-79  APIs:
   60  X509 subsystem
   61  BIO subsystem
   65  CMP subsystem
   70  PACKET layer
80-89  "larger" protocols (CA, CMS, OCSP, SSL, TSA)
90-98  misc
99     most time consuming tests [such as test_fuzz]
</pre> <h1><a class="anchor" id="autotoc_md975"></a>
A recipe that just runs a test executable</h1>
<p>A script that just runs a program looks like this: </p><pre class="fragment">#! /usr/bin/env perl

use OpenSSL::Test::Simple;

simple_test("test_{name}", "{name}test", "{name}");
</pre><p> <code>{name}</code> is the unique name you have chosen for your test.</p>
<p>The second argument to <code>simple_test</code> is the test executable, and <code>simple_test</code> expects it to be located in <code>test/</code></p>
<p>For documentation on <code>OpenSSL::Test::Simple</code>, do <code>perldoc util/perl/OpenSSL/Test/Simple.pm</code>.</p>
<h1><a class="anchor" id="autotoc_md976"></a>
A recipe that runs a more complex test</h1>
<p>For more complex tests, you will need to read up on Test::More and OpenSSL::Test. Test::More is normally preinstalled, do <code>man Test::More</code> for documentation. For OpenSSL::Test, do <code>perldoc util/perl/OpenSSL/Test.pm</code>.</p>
<p>A script to start from could be this: </p><pre class="fragment">#! /usr/bin/env perl

use strict;
use warnings;
use OpenSSL::Test;

setup("test_{name}");

plan tests =&gt; 2;                # The number of tests being performed

ok(test1, "test1");
ok(test2, "test1");

sub test1
{
    # test feature 1
}

sub test2
{
    # test feature 2
}
</pre> <h1><a class="anchor" id="autotoc_md977"></a>
Changes to test/build.info</h1>
<p>Whenever a new test involves a new test executable you need to do the following (at all times, replace {NAME} and {name} with the name of your test):</p>
<ul>
<li>add <code>{name}</code> to the list of programs under <code>PROGRAMS_NO_INST</code></li>
<li>create a three line description of how to build the test, you will have to modify the include paths and source files if you don't want to use the basic test framework: <pre class="fragment">SOURCE[{name}]={name}.c
INCLUDE[{name}]=.. ../include ../apps/include
DEPEND[{name}]=../libcrypto libtestutil.a
</pre> </li>
</ul>
<h1><a class="anchor" id="autotoc_md978"></a>
Generic form of C test executables</h1>
<p>include "testutil.h"</p>
<p>static int my_test(void) { int testresult = 0; /* Assume the test will fail */ int observed;</p>
<p>observed = function(); /* Call the code under test */ if (!TEST_int_eq(observed, 2)) /* Check the result is correct */ goto end; /* Exit on failure - optional */</p>
<p>testresult = 1; /* Mark the test case a success */ end: cleanup(); /* Any cleanup you require */ return testresult; }</p>
<p>int setup_tests(void) { ADD_TEST(my_test); /* Add each test separately */ return 1; /* Indicates success. Return 0 */ /* to produce an error with a */ /* usage message and -1 for */ /* failure to set up with no */ /* usage message. */ }</p>
<p>You should use the <code>TEST_xxx</code> macros provided by <code><a class="el" href="testutil_8h_source.html">testutil.h</a></code> to test all failure conditions. These macros produce an error message in a standard format if the condition is not met (and nothing if the condition is met). Additional information can be presented with the <code>TEST_info</code> macro that takes a <code>printf</code> format string and arguments. <code>TEST_error</code> is useful for complicated conditions, it also takes a <code>printf</code> format string and argument. In all cases the <code>TEST_xxx</code> macros are guaranteed to evaluate their arguments exactly once. This means that expressions with side effects are allowed as parameters. Thus, </p><pre class="fragment">if (!TEST_ptr(ptr = OPENSSL_malloc(..)))
</pre><p> works fine and can be used in place of: </p><pre class="fragment">ptr = OPENSSL_malloc(..);
if (!TEST_ptr(ptr))
</pre><p> The former produces a more meaningful message on failure than the latter.</p>
<p>Note that the test infrastructure automatically sets up all required environment variables (such as <code>OPENSSL_MODULES</code>, <code>OPENSSL_CONF</code>, etc.) for the tests. Individual tests may choose to override the default settings as required. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
