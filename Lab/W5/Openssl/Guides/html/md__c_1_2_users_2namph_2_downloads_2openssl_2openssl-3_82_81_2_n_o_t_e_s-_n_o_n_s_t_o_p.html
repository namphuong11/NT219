<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: NOTES FOR THE HPE NONSTOP PLATFORM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">NOTES FOR THE HPE NONSTOP PLATFORM</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md870"></a>
Requirement details</h1>
<p>In addition to the requirements and instructions listed in <a class="el" href="md__c_1_2_users_2namph_2_downloads_2openssl_2openssl-3_82_81_2_i_n_s_t_a_l_l.html">INSTALL.md</a>, the following are required as well:</p>
<ul>
<li>The TNS/X platform supports hardware randomization. Specify the <code>--with-rand-seed=rdcpu</code> option to the <code>./Configure</code> script. This is recommended but not required. <code>egd</code> is supported at 3.0 but cannot be used if FIPS is selected.</li>
<li>The TNS/E platform does not support hardware randomization, so specify the <code>--with-rand-seed=egd</code> option to the <code>./Configure</code> script.</li>
</ul>
<h1><a class="anchor" id="autotoc_md871"></a>
About c99 compiler</h1>
<p>The c99 compiler is required for building OpenSSL from source. While c11 may work, it has not been broadly tested. c99 is the only compiler prerequisite needed to build OpenSSL 3.0 on this platform. You should also have the FLOSS package installed on your system. The ITUGLIB FLOSS package is the only FLOSS variant that has been broadly tested.</p>
<h1><a class="anchor" id="autotoc_md872"></a>
Threading Models</h1>
<p>OpenSSL can be built either using the POSIX User Threads (PUT) threading model, or with threading support disabled. Select the following build configuration for each on the TNS/X (L-Series) platform:</p>
<ul>
<li><code>nonstop-nsx</code> or default will select an unthreaded 32-bit build.</li>
<li><code>nonstop-nsx_64</code> selects an unthreaded 64-bit memory and file length build.</li>
<li><code>nonstop-nsx_put</code> selects the PUT build.</li>
<li><code>nonstop-nsx_64_put</code> selects the 64-bit memory and file length PUT build.</li>
</ul>
<p>The SPT threading model is no longer supported as of OpenSSL 3.2.</p>
<h2><a class="anchor" id="autotoc_md873"></a>
TNS/E Considerations</h2>
<p>The TNS/E platform is build using the same set of builds specifying <code>nse</code> instead of <code>nsx</code> in the set above.</p>
<p>You cannot build for TNS/E for FIPS, so you must specify the <code>no-fips</code> option to <code>./Configure</code>.</p>
<h1><a class="anchor" id="autotoc_md874"></a>
Linking and Loading Considerations</h1>
<p>Because of how the NonStop Common Runtime Environment (CRE) works, there are restrictions on how programs can link and load with OpenSSL libraries. On current NonStop platforms, programs cannot both statically link OpenSSL libraries and dynamically load OpenSSL shared libraries concurrently. If this is done, there is a high probability of encountering a SIGSEGV condition relating to <code>atexit()</code> processing when a shared library is unloaded and when the program terminates. This limitation applies to all OpenSSL shared library components.</p>
<p>A resolution to this situation is under investigation.</p>
<h1><a class="anchor" id="autotoc_md875"></a>
About Prefix and OpenSSLDir</h1>
<p>Because there are many potential builds that must co-exist on any given NonStop node, managing the location of your build distribution is crucial. Keep each destination separate and distinct. Mixing any mode described in this document can cause application instability. The recommended approach is to specify the OpenSSL version and threading model in your configuration options, and keeping your memory and float options consistent, for example:</p>
<ul>
<li>For 1.1 <code>--prefix=/usr/local-ssl1.1 --openssldir=/usr/local-ssl1.1/ssl</code></li>
<li>For 1.1 PUT <code>--prefix=/usr/local-ssl1.1_put --openssldir=/usr/local-ssl1.1_put/ssl</code></li>
</ul>
<p>As of 3.0, the NonStop configurations use the multilib attribute to distinguish between different models:</p>
<ul>
<li>For 3.0 <code>--prefix=/usr/local-ssl3.0 --openssldir=/usr/local-ssl3.0/ssl</code></li>
</ul>
<p>The PUT model is placed in <code>${prefix}/lib-put</code> for 32-bit models and <code>${prefix}/lib64-put</code> for 64-bit models.</p>
<p>Use the <code>_RLD_LIB_PATH</code> environment variable in OSS to select the appropriate directory containing <code>libcrypto.so</code> and <code>libssl.so</code>. In GUARDIAN, use the <code>=_RLD_LIB_PATH</code> search define to locate the GUARDIAN subvolume where OpenSSL is installed.</p>
<h1><a class="anchor" id="autotoc_md876"></a>
Float Considerations</h1>
<p>OpenSSL is built using IEEE Float mode by default. If you need a different IEEE mode, create a new configuration specifying <code>tfloat-x86-64</code> (for Tandem Float) or <code>nfloat-x86-64</code> (for Neutral Float).</p>
<h1><a class="anchor" id="autotoc_md877"></a>
Memory Models</h1>
<p>The current OpenSSL default memory model uses the default platform address model. If you need a different address model, you must specify the appropriate c99 options for compile (<code>CFLAGS</code>) and linkers (<code>LDFLAGS</code>).</p>
<h1><a class="anchor" id="autotoc_md878"></a>
Cross Compiling on Windows</h1>
<p>To configure and compile OpenSSL, you will need to set up a Cygwin environment. The Cygwin tools should include bash, make, and any other normal tools required for building programs.</p>
<p>Your <code>PATH</code> must include the bin directory for the c99 cross-compiler, as in: </p><pre class="fragment">export PATH=/cygdrive/c/Program\ Files\ \&zwj;(x86\&zwj;)/HPE\ NonStop/L16.05/usr/bin:$PATH
</pre><p> This should be set before Configure is run. For the c99 cross-compiler to work correctly, you also need the <code>COMP_ROOT</code> set, as in: </p><pre class="fragment">export COMP_ROOT="C:\Program Files (x86)\HPE NonStop\L16.05"
</pre><p> <code>COMP_ROOT</code> needs to be in Windows form.</p>
<p><code>Configure</code> must specify the <code>no-makedepend</code> option otherwise errors will result when running the build because the c99 cross-compiler does not support the <code>gcc -MT</code> option. An example of a <code>Configure</code> command to be run from the OpenSSL directory is: </p><pre class="fragment">./Configure nonstop-nsx_64 no-makedepend --with-rand-seed=rdcpu
</pre><p> Do not forget to include any OpenSSL cross-compiling prefix and certificate options when creating your libraries.</p>
<p>The OpenSSL test suite will not run on your workstation. In order to verify the build, you will need to perform the build and test steps in OSS in your NonStop server. You can also build under gcc and run the test suite for Windows but that is not equivalent.</p>
<p><b>Note:</b> In the event that you are attempting a FIPS-compliant cross-compile, be aware that signatures may not match between builds done under OSS and under cross-compiles as the compilers do not necessarily generate identical objects. Anything and everything to do with FIPS is outside the scope of this document. Refer to the FIPS security policy for more information.</p>
<p>The following build configurations have been successfully attempted at one point or another. If you are successful in your cross-compile efforts, please update this list:</p>
<ul>
<li>nonstop-nsx_64</li>
<li>nonstop-nsx_64_put</li>
</ul>
<p><b>Note:</b> Cross-compile builds for TNS/E have not been attempted, but should follow the same considerations as for TNS/X above.</p>
<p>Also see the NSDEE discussion below for more historical information.</p>
<h1><a class="anchor" id="autotoc_md879"></a>
Cross Compiling with NSDEE</h1>
<p><b>Note:</b> None of these builds have been tested by the platform maintainer and are supplied for historical value. Please submit a Pull Request to OpenSSL should these need to be adjusted.</p>
<p>If you are attempting to build OpenSSL with NSDEE, you will need to specify the following variables. The following set of compiler defines are required: </p><pre class="fragment"># COMP_ROOT must be a full path for the build system (e.g. windows)
COMP_ROOT=$(cygpath -w /path/to/comp_root)
# CC must be executable by your shell
CC=/path/to/c99
</pre> <h2><a class="anchor" id="autotoc_md880"></a>
Optional Build Variables</h2>
<pre class="fragment">DBGFLAG="--debug"
CIPHENABLES="enable-ssl3 enable-ssl3-method enable-weak-ssl-ciphers enable-rc4"
</pre> <h2><a class="anchor" id="autotoc_md881"></a>
Internal Known TNS/X to TNS/E Cross Compile Variables</h2>
<p>The following definition is required if you are building on TNS/X for TNS/E and have access to a TNS/E machine on your EXPAND network - with an example node named <code>\CS3</code>: </p><pre class="fragment">SYSTEMLIBS="-L/E/cs3/usr/local/lib"
</pre> <h1><a class="anchor" id="autotoc_md882"></a>
Version Procedure (VPROC) Considerations</h1>
<p>If you require a VPROC entry for platform version identification, use the following variables:</p>
<h2><a class="anchor" id="autotoc_md883"></a>
For Itanium</h2>
<pre class="fragment">OPENSSL_VPROC_PREFIX=T0085H06
</pre> <h2><a class="anchor" id="autotoc_md884"></a>
For x86</h2>
<pre class="fragment">OPENSSL_VPROC_PREFIX=T0085L01
</pre> <h2><a class="anchor" id="autotoc_md885"></a>
Common Definition</h2>
<pre class="fragment">export OPENSSL_VPROC=${OPENSSL_VPROC_PREFIX}_$(
    . VERSION.dat
    if [ -n "$PRE_RELEASE_TAG" ]; then
        PRE_RELEASE_TAG="-$PRE_RELEASE_TAG"
    fi
    if [ -n "$BUILD_METADATA" ]; then
        BUILD_METADATA="+$BUILD_METADATA"
    fi
    echo "$MAJOR.$MINOR.$PATCH$PRE_RELEASE_TAG$BUILD_METADATA" |\
        sed -e 's/[-.+]/_/g'
    )
</pre> <h1><a class="anchor" id="autotoc_md886"></a>
Example Configure Targets</h1>
<p>For OSS targets, the main DLL names will be <code>libssl.so</code> and <code>libcrypto.so</code>. For GUARDIAN targets, DLL names will be <code>ssl</code> and <code>crypto</code>. The following assumes that your PWD is set according to your installation standards. </p><pre class="fragment">./Configure nonstop-nsx           --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=rdcpu ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nsx_g         --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=rdcpu ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nsx_put       --prefix=${PWD} \
    --openssldir=${PWD}/ssl threads "-D_REENTRANT" \
    --with-rand-seed=rdcpu ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nsx_64        --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=rdcpu ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nsx_64_put    --prefix=${PWD} \
    --openssldir=${PWD}/ssl threads "-D_REENTRANT" \
    --with-rand-seed=rdcpu ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nsx_g_tandem  --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=rdcpu ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}

./Configure nonstop-nse           --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nse_g         --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nse_put       --prefix=${PWD} \
    --openssldir=${PWD}/ssl threads "-D_REENTRANT" \
    --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nse_64        --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nse_64_put    --prefix=${PWD} \
    --openssldir=${PWD}/ssl threads "-D_REENTRANT"
    --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
./Configure nonstop-nse_g_tandem  --prefix=${PWD} \
    --openssldir=${PWD}/ssl no-threads \
    --with-rand-seed=egd ${CIPHENABLES} ${DBGFLAG} ${SYSTEMLIBS}
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
