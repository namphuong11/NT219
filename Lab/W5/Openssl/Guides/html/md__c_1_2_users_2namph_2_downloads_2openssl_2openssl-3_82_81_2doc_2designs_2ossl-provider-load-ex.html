<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: OSSL_PROVIDER_load_ex - activating providers with run-time configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">OSSL_PROVIDER_load_ex - activating providers with run-time configuration</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Currently any provider run-time activation requires the presence of the initialization parameters in the OpenSSL configuration file. Otherwise the provider will be activated with some default settings, that may or may not work for a particular application. For real-world systems it may require providing a specially designed OpenSSL configuration file and passing it somehow (e.g. via environment), which has obvious drawbacks.</p>
<p>We need a possibility to initialize providers on per-application level according to per-application parameters. It's necessary for example for PKCS#11 provider (where different applications may use different devices with different drivers) and will be useful for some other providers. In case of Red Hat it is also usable for FIPS provider.</p>
<p>OpenSSL 3.2 introduces the API</p>
<div class="fragment"><div class="line">OSSL_PROVIDER *OSSL_PROVIDER_load_ex(OSSL_LIB_CTX *libctx, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,</div>
<div class="line">                                     OSSL_PARAM params[]);</div>
</div><!-- fragment --><p>intended to configure the provider at load time.</p>
<p>It accepts only parameters of type <code>OSSL_PARAM_UTF8_STRING</code> because any provider can be initialized from the config file where the values are represented as strings and provider init function has to deal with it.</p>
<p>Explicitly configured parameters can differ from the parameters named in the configuration file. Here are the current design decisions and some possible future steps.</p>
<h1><a class="anchor" id="autotoc_md227"></a>
Real-world cases</h1>
<p>Many applications use PKCS#11 API with specific drivers. OpenSSL PKCS#11 provider <a href="https://github.com/latchset/pkcs11-provider">https://github.com/latchset/pkcs11-provider</a> also provides a set of tweaks usable in particular situations. So there are several scenarios for which the new API can be used:</p>
<ol type="1">
<li>Configure a provider in the config file, activate on demand</li>
<li>Load/activate a provider run-time with parameters</li>
</ol>
<h1><a class="anchor" id="autotoc_md228"></a>
Current design</h1>
<p>When the provider is already loaded an activated in the current library context, the <code>OSSL_PROVIDER_load_ex</code> call simply returns the active provider and the extra parameters are ignored.</p>
<p>In all other cases, the extra parameters provided by the <code>OSSL_PROVIDER_load_ex</code> call are applied and the values from the config file are ignored.</p>
<p>Separate instances of the provider can be loaded in the separate library contexts.</p>
<p>Several instances of the same provider can be loaded in the same context using different section names, module names (e.g. via symlinks) and provider names. But unless the provider supports some configuration options, the algorithms in this case will have the same <code>provider</code> property and the result of fetching is not determined. We strongly discourage against this trick.</p>
<p>Changing the loaded provider configuration at runtime is not supported. If it is necessary, the provider needs to be unloaded using <code>OSSL_PROVIDER_unload</code> and reloaded using <code>OSSL_PROVIDER_load</code> or <code>OSSL_PROVIDER_load_ex</code> should be used.</p>
<h1><a class="anchor" id="autotoc_md229"></a>
Possible future steps</h1>
<ol type="1">
<li>We should provide some API function accessing the configuration parameters of a particular provider. Having it, the application will be able to combine some default values with the app-specific ones in more or less intellectual way.</li>
<li>We probably should remove the <code><a class="el" href="struct_i_n_f_o_p_a_i_r.html">INFOPAIR</a></code> structure and use the <code>OSSL_PARAM</code> one instead. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
