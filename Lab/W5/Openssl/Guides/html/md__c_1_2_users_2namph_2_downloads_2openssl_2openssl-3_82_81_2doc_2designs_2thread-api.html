<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: Thread Pool Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Thread Pool Support</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>OpenSSL wishes to support the internal use of threads for purposes of concurrency and parallelism in some circumstances. There are various reasons why this is desirable:</p>
<ul>
<li>Some algorithms are designed to be run in parallel (Argon2);</li>
<li>Some transports (e.g. QUIC, DTLS) may need to handle timer events independently of application calls to OpenSSL.</li>
</ul>
<p>To support this end, OpenSSL can manage an internal thread pool. Tasks can be scheduled on the internal thread pool.</p>
<p>There is currently a single model available to an application which wants to use the thread pool functionality, known as the “default model”. More models providing more flexible or advanced usage may be added in future releases.</p>
<p>A thread pool is managed on a per-<code>OSSL_LIB_CTX</code> basis.</p>
<h1><a class="anchor" id="autotoc_md513"></a>
Default Model</h1>
<p>In the default model, OpenSSL creates and manages threads up to a maximum number of threads authorized by the application.</p>
<p>The application enables thread pooling by calling the following function during its initialisation:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Set the maximum number of threads to be used by the thread pool.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * If the argument is 0, thread pooling is disabled. OpenSSL will not create any</span></div>
<div class="line"><span class="comment"> * threads and existing threads in the thread pool will be torn down.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Returns 1 on success and 0 on failure. Returns failure if OpenSSL-managed</span></div>
<div class="line"><span class="comment"> * thread pooling is not supported (for example, if it is not supported on the</span></div>
<div class="line"><span class="comment"> * current platform, or because OpenSSL is not built with the necessary</span></div>
<div class="line"><span class="comment"> * support).</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> OSSL_set_max_threads(OSSL_LIB_CTX *ctx, uint64_t max_threads);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Get the maximum number of threads currently allowed to be used by the</span></div>
<div class="line"><span class="comment"> * thread pool. If thread pooling is disabled or not available, returns 0.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">uint64_t OSSL_get_max_threads(OSSL_LIB_CTX *ctx);</div>
</div><!-- fragment --><p>The maximum thread count is a limit, not a target. Threads will not be spawned unless (and until) there is demand.</p>
<p>As usual, <code>ctx</code> can be NULL to use the default library context.</p>
<h1><a class="anchor" id="autotoc_md514"></a>
Capability Detection</h1>
<p>These functions allow the caller to determine if OpenSSL was built with threads support.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Retrieves flags indicating what threading functionality OpenSSL can support</span></div>
<div class="line"><span class="comment"> * based on how it was built and the platform on which it was running.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment">/* Is thread pool functionality supported at all? */</span></div>
<div class="line"><span class="preprocessor">#define OSSL_THREAD_SUPPORT_FLAG_THREAD_POOL    (1U&lt;&lt;0)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Is the default model supported? If THREAD_POOL is supported but DEFAULT_SPAWN</span></div>
<div class="line"><span class="comment"> * is not supported, another model must be used. Note that there is currently</span></div>
<div class="line"><span class="comment"> * only one supported model (the default model), but there may be more in the</span></div>
<div class="line"><span class="comment"> * future.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define OSSL_THREAD_SUPPORT_FLAG_DEFAULT_SPAWN  (1U&lt;&lt;1)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Returns zero or more of OSSL_THREAD_SUPPORT_FLAG_*. */</span></div>
<div class="line">uint32_t OSSL_get_thread_support_flags(<span class="keywordtype">void</span>);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md515"></a>
Build Options</h1>
<p>A build option <code>thread-pool</code>/<code>no-thread-pool</code> will be introduced which allows thread pool functionality to be compiled out. <code>no-thread-pool</code> implies <code>no-default-thread-pool</code>.</p>
<p>A build option <code>default-thread-pool</code>/<code>no-default-thread-pool</code> will be introduced which allows the default thread pool functionality to be compiled out. If this functionality is compiled out, another thread pool model must be used. Since the default model is the only currently supported model, disabling the default model renders threading functionality unusable. As such, there is little reason to use this option instead of <code>thread-pool/no-thread-pool</code>, however this option is nonetheless provided for symmetry when additional models are introduced in the future.</p>
<h1><a class="anchor" id="autotoc_md516"></a>
Internals</h1>
<p>New internal components will need to be introduced (e.g. condition variables) to support this functionality, however there is no intention of making this functionality public at this time. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
