<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: Notes for Windows platforms</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Notes for Windows platforms</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>Native builds using Visual C++</li>
<li>Native builds using Embarcadero C++Builder</li>
<li>Native builds using MinGW</li>
<li>Linking native applications</li>
<li>Hosted builds using Cygwin</li>
</ul>
<p>There are various options to build and run OpenSSL on the Windows platforms.</p>
<p>"Native" OpenSSL uses the Windows APIs directly at run time. To build a native OpenSSL you can either use: </p><pre class="fragment">Microsoft Visual C++ (MSVC) C compiler on the command line
</pre><p> or Embarcadero C++Builder or MinGW cross compiler run on the GNU-like development environment MSYS2 or run on Linux or Cygwin</p>
<p>"Hosted" OpenSSL relies on an external POSIX compatibility layer for building (using GNU/Unix shell, compiler, and tools) and at run time. For this option, you can use Cygwin.</p>
<h1><a class="anchor" id="autotoc_md908"></a>
Native builds using Visual C++</h1>
<p>The native builds using Visual C++ have a <code>VC-*</code> prefix.</p>
<h2><a class="anchor" id="autotoc_md909"></a>
Requirement details</h2>
<p>In addition to the requirements and instructions listed in <code>INSTALL.md</code>, these are required as well:</p>
<h3><a class="anchor" id="autotoc_md910"></a>
Perl</h3>
<p>We recommend Strawberry Perl, available from <a href="http://strawberryperl.com/">http://strawberryperl.com/</a> Please read NOTES.PERL for more information, including the use of CPAN. An alternative is ActiveState Perl, <a href="https://www.activestate.com/ActivePerl">https://www.activestate.com/ActivePerl</a> for which you may need to explicitly build the Perl module Win32/Console.pm via <a href="https://platform.activestate.com/ActiveState">https://platform.activestate.com/ActiveState</a> and then download it.</p>
<h3><a class="anchor" id="autotoc_md911"></a>
Microsoft Visual C compiler.</h3>
<p>Since these are proprietary and ever-changing we cannot test them all. Older versions may not work. Use a recent version wherever possible.</p>
<h3><a class="anchor" id="autotoc_md912"></a>
Netwide Assembler (NASM)</h3>
<p>NASM is the only supported assembler. It is available from <a href="https://www.nasm.us">https://www.nasm.us</a>.</p>
<h2><a class="anchor" id="autotoc_md913"></a>
Quick start</h2>
<ol type="1">
<li>Install Perl</li>
<li>Install NASM</li>
<li>Make sure both Perl and NASM are on your PATH%</li>
<li>Use Visual Studio Developer Command Prompt with administrative privileges, choosing one of its variants depending on the intended architecture. Or run <code>cmd</code> and execute <code>vcvarsall.bat</code> with one of the options <code>x86</code>, <code>x86_amd64</code>, <code>x86_arm</code>, <code>x86_arm64</code>, <code>amd64</code>, <code>amd64_x86</code>, <code>amd64_arm</code>, or <code>amd64_arm64</code>. This sets up the environment variables needed for <code>nmake.exe</code>, <code>cl.exe</code>, etc. See also <a href="https://docs.microsoft.com/cpp/build/building-on-the-command-line">https://docs.microsoft.com/cpp/build/building-on-the-command-line</a></li>
<li>From the root of the OpenSSL source directory enter<ul>
<li><code>perl Configure VC-WIN32</code> if you want 32-bit OpenSSL or</li>
<li><code>perl Configure VC-WIN64A</code> if you want 64-bit OpenSSL or</li>
<li><code>perl Configure VC-WIN64-ARM</code> if you want Windows on Arm (win-arm64) OpenSSL or</li>
<li><code>perl Configure VC-WIN64-CLANGASM-ARM</code> if you want Windows on Arm (win-arm64) OpenSSL with assembly support using clang-cl as assembler or</li>
<li><code>perl Configure VC-CLANG-WIN64-CLANGASM-ARM</code> if you want Windows on Arm (win-arm64) OpenSSL using clang-cl as both compiler and assembler or</li>
<li><code>perl Configure VC-WIN32-HYBRIDCRT</code> if you want 32-bit OpenSSL dependent on the Universal CRT or</li>
<li><code>perl Configure VC-WIN64A-HYBRIDCRT</code> if you want 64-bit OpenSSL dependent on the Universal CRT or</li>
<li><code>perl Configure</code> to let Configure figure out the platform</li>
</ul>
</li>
<li><code>nmake</code></li>
<li><code>nmake test</code></li>
<li><code>nmake install</code></li>
</ol>
<p>For the full installation instructions, or if anything goes wrong at any stage, check the INSTALL.md file.</p>
<h2><a class="anchor" id="autotoc_md914"></a>
Installation directories</h2>
<p>The default installation directories are derived from environment variables.</p>
<p>For VC-WIN32, the following defaults are use: </p><pre class="fragment">PREFIX:      %ProgramFiles(x86)%\OpenSSL
OPENSSLDIR:  %CommonProgramFiles(x86)%\SSL
</pre><p> For VC-WIN64, the following defaults are use: </p><pre class="fragment">PREFIX:      %ProgramW6432%\OpenSSL
OPENSSLDIR:  %CommonProgramW6432%\SSL
</pre><p> Should those environment variables not exist (on a pure Win32 installation for examples), these fallbacks are used: </p><pre class="fragment">PREFIX:      %ProgramFiles%\OpenSSL
OPENSSLDIR:  %CommonProgramFiles%\SSL
</pre><p> ALSO NOTE that those directories are usually write protected, even if your account is in the Administrators group. To work around that, start the command prompt by right-clicking on it and choosing "Run as
Administrator" before running <code>nmake install</code>. The other solution is, of course, to choose a different set of directories by using <code>--prefix</code> and <code>--openssldir</code> when configuring.</p>
<h2><a class="anchor" id="autotoc_md915"></a>
Special notes for Universal Windows Platform builds, aka <code>VC-*-UWP</code></h2>
<ul>
<li>UWP targets only support building the static and dynamic libraries.</li>
<li>You should define the platform type to <code>uwp</code> and the target arch via <code>vcvarsall.bat</code> before you compile. For example, if you want to build <code>arm64</code> builds, you should run <code>vcvarsall.bat x86_arm64 uwp</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md916"></a>
Native builds using Embarcadero C++Builder</h1>
<p>This toolchain (a descendant of Turbo/Borland C++) is an alternative to MSVC. OpenSSL currently includes an experimental 32-bit configuration targeting the Clang-based compiler (<code>bcc32c.exe</code>) in v10.3.3 Community Edition. <a href="https://www.embarcadero.com/products/cbuilder/starter">https://www.embarcadero.com/products/cbuilder/starter</a></p>
<ol type="1">
<li>Install Perl.</li>
<li>Open the RAD Studio Command Prompt.</li>
<li>Go to the root of the OpenSSL source directory and run: <code>perl Configure BC-32 --prefix=CD%</code></li>
<li><code>make -N</code></li>
<li><code>make -N test</code></li>
<li>Build your program against this OpenSSL:<ul>
<li>Set your include search path to the "include" subdirectory of OpenSSL.</li>
<li>Set your library search path to the OpenSSL source directory.</li>
</ul>
</li>
</ol>
<p>Note that this is very experimental. Support for 64-bit and other Configure options is still pending.</p>
<h1><a class="anchor" id="autotoc_md917"></a>
Native builds using MinGW</h1>
<p>MinGW offers an alternative way to build native OpenSSL, by cross compilation.</p>
<ul>
<li><p class="startli">Usually the build is done on Windows in a GNU-like environment called MSYS2.</p>
<p class="startli">MSYS2 provides GNU tools, a Unix-like command prompt, and a UNIX compatibility layer for applications. However, in this context it is only used for building OpenSSL. The resulting OpenSSL does not rely on MSYS2 to run and is fully native.</p>
<p class="startli">Requirement details</p><ul>
<li>MSYS2 shell, from <a href="https://www.msys2.org/">https://www.msys2.org/</a></li>
<li>Perl, at least version 5.10.0, which usually comes pre-installed with MSYS2</li>
<li>make, installed using <code>pacman -S make</code> into the MSYS2 environment</li>
<li>MinGW[64] compiler: <code>mingw-w64-i686-gcc</code> and/or <code>mingw-w64-x86_64-gcc</code>. These compilers must be on your MSYS2 $PATH. A common error is to not have these on your $PATH. The MSYS2 version of gcc will not work correctly here.</li>
</ul>
<p class="startli">In the MSYS2 shell do the configuration depending on the target architecture: </p><pre class="fragment">./Configure mingw ...
</pre><p> or </p><pre class="fragment">./Configure mingw64 ...
</pre><p> or </p><pre class="fragment">./Configure ...
</pre><p> for the default architecture.</p>
<p class="startli">Apart from that, follow the Unix / Linux instructions in <code>INSTALL.md</code>.</p>
</li>
<li><p class="startli">It is also possible to build mingw[64] on Linux or Cygwin.</p>
<p class="startli">In this case configure with the corresponding <code>--cross-compile-prefix=</code> option. For example </p><pre class="fragment">./Configure mingw --cross-compile-prefix=i686-w64-mingw32- ...
</pre><p> or </p><pre class="fragment">./Configure mingw64 --cross-compile-prefix=x86_64-w64-mingw32- ...
</pre><p> This requires that you've installed the necessary add-on packages for mingw[64] cross compilation.</p>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md918"></a>
Linking native applications</h1>
<p>This section applies to all native builds.</p>
<p>If you link with static OpenSSL libraries, then you're expected to additionally link your application with <code>WS2_32.LIB</code>, <code>GDI32.LIB</code>, <code>ADVAPI32.LIB</code>, <code>CRYPT32.LIB</code> and <code>USER32.LIB</code>. Those developing non-interactive service applications might feel concerned about linking with <code>GDI32.LIB</code> and <code>USER32.LIB</code>, as they are justly associated with interactive desktop, which is not available to service processes. The toolkit is designed to detect in which context it's currently executed, GUI, console app or service, and act accordingly, namely whether to actually make GUI calls. Additionally, those who wish to <code>/DELAYLOAD:GDI32.DLL</code> and <code>/DELAYLOAD:USER32.DLL</code> and actually keep them off service process should consider implementing and exporting from .exe image in question own <code>_OPENSSL_isservice</code> not relying on <code>USER32.DLL</code>. E.g., on Windows Vista and later you could: </p><pre class="fragment">   __declspec(dllexport) __cdecl BOOL _OPENSSL_isservice(void)
   {
       DWORD sess;

       if (ProcessIdToSessionId(GetCurrentProcessId(), &amp;sess))
           return sess == 0;
       return FALSE;
   }
</pre><p> If you link with OpenSSL .DLLs, then you're expected to include into your application code a small "shim" snippet, which provides the glue between the OpenSSL BIO layer and your compiler run-time. See also the OPENSSL_Applink manual page.</p>
<h1><a class="anchor" id="autotoc_md919"></a>
Hosted builds using Cygwin</h1>
<p>Cygwin implements a POSIX/Unix runtime system (<code>cygwin1.dll</code>) on top of the Windows subsystem and provides a Bash shell and GNU tools environment. Consequently, a build of OpenSSL with Cygwin is virtually identical to the Unix procedure.</p>
<p>To build OpenSSL using Cygwin, you need to:</p>
<ul>
<li>Install Cygwin, see <a href="https://cygwin.com/">https://cygwin.com/</a></li>
<li>Install Cygwin Perl, at least version 5.10.0 and ensure it is in the $PATH</li>
<li>Run the Cygwin Bash shell</li>
</ul>
<p>Apart from that, follow the Unix / Linux instructions in INSTALL.md.</p>
<p>NOTE: <code>make test</code> and normal file operations may fail in directories mounted as text (i.e. <code>mount -t c:\somewhere /home</code>) due to Cygwin stripping of carriage returns. To avoid this, ensure that a binary mount is used, e.g. <code>mount -b c:\somewhere /home</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
