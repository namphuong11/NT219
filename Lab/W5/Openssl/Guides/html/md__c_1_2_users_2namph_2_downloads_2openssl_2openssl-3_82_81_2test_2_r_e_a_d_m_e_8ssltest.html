<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Openssl Guides: SSL tests</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Openssl Guides
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">SSL tests</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>SSL testcases are configured in the <code>ssl-tests</code> directory.</p>
<p>Each <code>ssl_*.cnf.in</code> file contains a number of test configurations. These files are used to generate testcases in the OpenSSL CONF format.</p>
<p>The precise test output can be dependent on the library configuration. The test harness generates the output files on the fly.</p>
<p>However, for verification, we also include checked-in configuration outputs corresponding to the default configuration. These testcases live in <code>test/ssl-tests/*.cnf</code> files.</p>
<p>For more details, see <code>ssl-tests/01-simple.cnf.in</code> for an example.</p>
<h1><a class="anchor" id="autotoc_md993"></a>
Configuring the test</h1>
<p>First, give your test a name. The names do not have to be unique.</p>
<p>An example test input looks like this: </p><pre class="fragment">{
    name =&gt; "test-default",
    server =&gt; { "CipherString" =&gt; "DEFAULT" },
    client =&gt; { "CipherString" =&gt; "DEFAULT" },
    test   =&gt; { "ExpectedResult" =&gt; "Success" },
}
</pre><p> The test section supports the following options</p>
<h2><a class="anchor" id="autotoc_md994"></a>
Test mode</h2>
<ul>
<li>Method - the method to test. One of DTLS or TLS.</li>
<li>HandshakeMode - which handshake flavour to test:<ul>
<li>Simple - plain handshake (default)</li>
<li>Resume - test resumption</li>
<li>RenegotiateServer - test server initiated renegotiation</li>
<li>RenegotiateClient - test client initiated renegotiation</li>
</ul>
</li>
</ul>
<p>When HandshakeMode is Resume or Renegotiate, the original handshake is expected to succeed. All configured test expectations are verified against the second handshake.</p>
<ul>
<li>ApplicationData - amount of application data bytes to send (integer, defaults to 256 bytes). Applies to both client and server. Application data is sent in 64kB chunks (but limited by MaxFragmentSize and available parallelization, see below).</li>
<li>MaxFragmentSize - maximum send fragment size (integer, defaults to 512 in tests - see <code>SSL_CTX_set_max_send_fragment</code> for documentation). Applies to both client and server. Lowering the fragment size will split handshake and application data up between more <code>SSL_write</code> calls, thus allowing to exercise different code paths. In particular, if the buffer size (64kB) is at least four times as large as the maximum fragment, interleaved multi-buffer crypto implementations may be used on some platforms.</li>
</ul>
<h2><a class="anchor" id="autotoc_md995"></a>
Test expectations</h2>
<ul>
<li>ExpectedResult - expected handshake outcome. One of<ul>
<li>Success - handshake success</li>
<li>ServerFail - serverside handshake failure</li>
<li>ClientFail - clientside handshake failure</li>
<li>InternalError - some other error</li>
</ul>
</li>
<li>ExpectedClientAlert, ExpectedServerAlert - expected alert. See <code>test/helpers/ssl_test_ctx.c</code> for known values. Note: the expected alert is currently matched against the <em>last</em> received alert (i.e., a fatal alert or a <code>close_notify</code>). Warning alert expectations are not yet supported. (A warning alert will not be correctly matched, if followed by a <code>close_notify</code> or another alert.)</li>
<li>ExpectedProtocol - expected negotiated protocol. One of SSLv3, TLSv1, TLSv1.1, TLSv1.2.</li>
<li>SessionTicketExpected - whether or not a session ticket is expected<ul>
<li>Ignore - do not check for a session ticket (default)</li>
<li>Yes - a session ticket is expected</li>
<li>No - a session ticket is not expected</li>
</ul>
</li>
<li>SessionIdExpected - whether or not a session id is expected<ul>
<li>Ignore - do not check for a session id (default)</li>
<li>Yes - a session id is expected</li>
<li>No - a session id is not expected</li>
</ul>
</li>
<li>ResumptionExpected - whether or not resumption is expected (Resume mode only)<ul>
<li>Yes - resumed handshake</li>
<li>No - full handshake (default)</li>
</ul>
</li>
<li>ExpectedNPNProtocol, ExpectedALPNProtocol - NPN and ALPN expectations.</li>
<li>ExpectedTmpKeyType - the expected algorithm or curve of server temp key</li>
<li>ExpectedServerCertType, ExpectedClientCertType - the expected algorithm or curve of server or client certificate</li>
<li>ExpectedServerSignHash, ExpectedClientSignHash - the expected signing hash used by server or client certificate</li>
<li>ExpectedServerSignType, ExpectedClientSignType - the expected signature type used by server or client when signing messages</li>
<li>ExpectedClientCANames - for client auth list of CA names the server must send. If this is "empty" the list is expected to be empty otherwise it is a file of certificates whose subject names form the list.</li>
<li>ExpectedServerCANames - list of CA names the client must send, TLS 1.3 only. If this is "empty" the list is expected to be empty otherwise it is a file of certificates whose subject names form the list.</li>
</ul>
<h1><a class="anchor" id="autotoc_md996"></a>
Configuring the client and server</h1>
<p>The client and server configurations can be any valid <code>SSL_CTX</code> configurations. For details, see the manpages for <code>SSL_CONF_cmd</code>.</p>
<p>Give your configurations as a dictionary of CONF commands, e.g. </p><pre class="fragment">server =&gt; {
    "CipherString" =&gt; "DEFAULT",
    "MinProtocol" =&gt; "TLSv1",
}
</pre><p> The following sections may optionally be defined:</p>
<ul>
<li>server2 - this section configures a secondary context that is selected via the ServerName test option. This context is used whenever a ServerNameCallback is specified. If the server2 section is not present, then the configuration matches server.</li>
<li>resume_server - this section configures the client to resume its session against a different server. This context is used whenever HandshakeMode is Resume. If the resume_server section is not present, then the configuration matches server.</li>
<li>resume_client - this section configures the client to resume its session with a different configuration. In practice this may occur when, for example, upgraded clients reuse sessions persisted on disk. This context is used whenever HandshakeMode is Resume. If the resume_client section is not present, then the configuration matches client.</li>
</ul>
<h2><a class="anchor" id="autotoc_md997"></a>
Configuring callbacks and additional options</h2>
<p>Additional handshake settings can be configured in the <code>extra</code> section of each client and server: </p><pre class="fragment">client =&gt; {
    "CipherString" =&gt; "DEFAULT",
    extra =&gt; {
        "ServerName" =&gt; "server2",
    }
}
</pre> <h3><a class="anchor" id="autotoc_md998"></a>
Supported client-side options</h3>
<ul>
<li>ClientVerifyCallback - the client's custom certificate verify callback. Used to test callback behaviour. One of<ul>
<li>None - no custom callback (default)</li>
<li>AcceptAll - accepts all certificates.</li>
<li>RejectAll - rejects all certificates.</li>
</ul>
</li>
<li>ServerName - the server the client should attempt to connect to. One of<ul>
<li>None - do not use SNI (default)</li>
<li>server1 - the initial context</li>
<li>server2 - the secondary context</li>
<li>invalid - an unknown context</li>
</ul>
</li>
<li>CTValidation - Certificate Transparency validation strategy. One of<ul>
<li>None - no validation (default)</li>
<li>Permissive - SSL_CT_VALIDATION_PERMISSIVE</li>
<li>Strict - SSL_CT_VALIDATION_STRICT</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md999"></a>
Supported server-side options</h3>
<ul>
<li>ServerNameCallback - the SNI switching callback to use<ul>
<li>None - no callback (default)</li>
<li>IgnoreMismatch - continue the handshake on SNI mismatch</li>
<li>RejectMismatch - abort the handshake on SNI mismatch</li>
</ul>
</li>
<li>BrokenSessionTicket - a special test case where the session ticket callback does not initialize crypto.<ul>
<li>No (default)</li>
<li>Yes</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md1000"></a>
Mutually supported options</h3>
<ul>
<li>NPNProtocols, ALPNProtocols - NPN and ALPN settings. Server and client protocols can be specified as a comma-separated list, and a callback with the recommended behaviour will be installed automatically.</li>
<li>SRPUser, SRPPassword - SRP settings. For client, this is the SRP user to connect as; for server, this is a known SRP user.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1001"></a>
Default server and client configurations</h2>
<p>The default server certificate and CA files are added to the configurations automatically. Server certificate verification is requested by default.</p>
<p>You can override these options by redefining them: </p><pre class="fragment">client =&gt; {
    "VerifyCAFile" =&gt; "/path/to/custom/file"
}
</pre><p> or by deleting them </p><pre class="fragment">client =&gt; {
    "VerifyCAFile" =&gt; undef
}
</pre> <h1><a class="anchor" id="autotoc_md1002"></a>
Adding a test to the test harness</h1>
<ol type="1">
<li>Add a new test configuration to <code>test/ssl-tests</code>, following the examples of existing <code>*.cnf.in</code> files (for example, <code>01-simple.cnf.in</code>).</li>
<li><p class="startli">Generate the generated <code>*.cnf</code> test input file. You can do so by running <code>generate_ssl_tests.pl</code>:</p>
<p class="startli">$ ./config $ cd test $ TOP=.. perl -I ../util/perl/ generate_ssl_tests.pl \ ssl-tests/my.cnf.in default &gt; ssl-tests/my.cnf</p>
</li>
</ol>
<p>where <code>my.cnf.in</code> is your test input file and <code>default</code> is the provider to use. For all the pre-generated test files you should use the default provider.</p>
<p>For example, to generate the test cases in <code>ssl-tests/01-simple.cnf.in</code>, do </p><pre class="fragment">$ TOP=.. perl -I ../util/perl/ generate_ssl_tests.pl \
  ssl-tests/01-simple.cnf.in default &gt; ssl-tests/01-simple.cnf
</pre><p> Alternatively (hackish but simple), you can comment out </p><pre class="fragment">unlink glob $tmp_file;
</pre><p> in <code>test/recipes/80-test_ssl_new.t</code> and run </p><pre class="fragment">$ make TESTS=test_ssl_new test
</pre><p> This will save the generated output in a <code>*.tmp</code> file in the build directory.</p>
<ol type="1">
<li>Update the number of tests planned in <code>test/recipes/80-test_ssl_new.t</code>. If the test suite has any skip conditions, update those too (see <code>test/recipes/80-test_ssl_new.t</code> for details).</li>
</ol>
<h1><a class="anchor" id="autotoc_md1003"></a>
Running the tests with the test harness</h1>
<pre class="fragment">HARNESS_VERBOSE=yes make TESTS=test_ssl_new test
</pre> <h1><a class="anchor" id="autotoc_md1004"></a>
Running a test manually</h1>
<p>These steps are only needed during development. End users should run <code>make test</code> or follow the instructions above to run the SSL test suite.</p>
<p>To run an SSL test manually from the command line, the <code>TEST_CERTS_DIR</code> environment variable to point to the location of the certs. E.g., from the root OpenSSL directory, do </p><pre class="fragment">$ CTLOG_FILE=test/ct/log_list.cnf TEST_CERTS_DIR=test/certs test/ssl_test \
  test/ssl-tests/01-simple.cnf default
</pre><p> or for shared builds </p><pre class="fragment">$ CTLOG_FILE=test/ct/log_list.cnf  TEST_CERTS_DIR=test/certs \
  util/wrap.pl test/ssl_test test/ssl-tests/01-simple.cnf default
</pre><p> In the above examples, <code>default</code> is the provider to use.</p>
<p>Note that the test expectations sometimes depend on the Configure settings. For example, the negotiated protocol depends on the set of available (enabled) protocols: a build with <code>enable-ssl3</code> has different test expectations than a build with <code>no-ssl3</code>.</p>
<p>The Perl test harness automatically generates expected outputs, so users who just run <code>make test</code> do not need any extra steps.</p>
<p>However, when running a test manually, keep in mind that the repository version of the generated <code>test/ssl-tests/*.cnf</code> correspond to expected outputs in with the default Configure options. To run <code>ssl_test</code> manually from the command line in a build with a different configuration, you may need to generate the right <code>*.cnf</code> file from the <code>*.cnf.in</code> input first.</p>
<h1><a class="anchor" id="autotoc_md1005"></a>
Running a test manually via make</h1>
<p>Individual tests may be run by adding the SSL_TESTS variable to the <code>make</code> command line. The SSL_TESTS variable is set to the list of input (or ".in") files. The values in SSL_TESTS are globbed. </p><pre class="fragment">$ make test TESTS=test_ssl_new SSL_TESTS="0*.cnf.in"

$ make test TESTS=test_ssl_new SSL_TESTS="01-simple.cnf.in 05-sni.cnf.in"
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
